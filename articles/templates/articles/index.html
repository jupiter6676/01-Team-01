{% extends 'base.html' %}
{% load static %}

{% block css %}
  <style>
    .hashtags {
      width: 100%;
      min-height: 24px;
      text-overflow: ellipsis;
      white-space: nowrap;  
      overflow: hidden;
    }
  </style>
{% endblock css %}

{% block content %}
  <form role="search" action="{% url 'articles:search' %}" class="p-5">
    <div class="d-flex justify-content-center">
      <select class="form-select w-auto" name="search_option">
        <option value="title">제목</option>
        <option value="title_content">제목+내용</option>
        <option value="hashtag">해시태그</option>
        <option value="user">작성자</option>
      </select>
      
      <input class="form-control w-50 mx-2" type="search" placeholder="Search" name="search">
      <input class="btn btn-success" type="submit" value="검색">
    </div>
  </form>

  <div class="row">
    {% for article in articles %}
      <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 p-3">
        <a href="{% url 'articles:detail' article.pk %}">
          <div class="card">
            <!-- 첫 번째 이미지를 썸네일로 -->
            {% if article.photo_set.all.0.image %}
              <img src="{{ article.photo_set.all.0.image.url }}" class="card-img-top" alt="..." height="240px">
            {% else %}
              <img src="https://dummyimage.com/1200x960/000000/c4c4c4" class="card-img-top" height="240px">
            {% endif %}

            <div class="card-body d-flex flex-column justify-content-between" style="height: 12rem">
              <!-- 유저 -->
              <div class="mb-2">
                <a href="{% url 'accounts:detail' article.user.pk %}" class="text-dark">
                  {% if article.user.profile.image %}
                    <img src="{{ article.user.profile.image.url }}" alt="{{ article.user.profile.image }}" class="rounded-2 border border-1" width="40px">
                  {% else %}
                    <img src="{% static 'images/dummy-image-square.jpg' %}" alt="" class="rounded-2 border border-1" width="40px">
                  {% endif %}
                  <span class="ms-2">{{ article.user.nickname }}</span>
                </a>
              </div>

              <a href="{% url 'articles:detail' article.pk %}" class="text-dark">
              <div class="d-flex justify-content-between"><h4 class="card-title mb-3">{{ article.title }}</h4>
                <div><svg width="26" height="26" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 2.31055C6.81525 2.31194 5.67942 2.78321 4.84166 3.62096C4.00391 4.45871 3.53265 5.59454 3.53125 6.7793C3.52984 7.74748 3.84609 8.6894 4.4315 9.46055C4.4315 9.46055 4.55338 9.62102 4.57329 9.64417L8 13.6855L11.4283 9.64214C11.4462 9.62061 11.5685 9.46055 11.5685 9.46055L11.5689 9.45933C12.154 8.68851 12.4701 7.74704 12.4688 6.7793C12.4674 5.59454 11.9961 4.45871 11.1583 3.62096C10.3206 2.78321 9.18476 2.31194 8 2.31055ZM9.4625 8.81055L8 7.87983L6.5375 8.81055L6.78125 7.15548L5.5625 6.03708L7.26875 5.83111L8 4.3418L8.77675 5.83152L10.4375 6.03708L9.21875 7.15548L9.4625 8.81055Z" fill="#0060FF"></path></svg>
          <span class="text-b3 text-primary">{{article.location}}</span></div>
                
              </div>
                
              </a>

              <div class="hashtags col-lg-8 col-md-10 mb-2">
                {% for tag in article.tags.all %}
                  <a href="/search/?search_option=hashtag&amp;search={{ tag.name }}" class="text-decoration-none fs-5">#{{ tag.name }}</a>
                {% endfor %}
              </div>

              <!-- 좋아요, 댓글, 조회수 -->
              <div class="text-muted fs-5">
                <span class="bi bi-heart me-3">
                  <span class="">{{ article.like_users.count }}</span>
                </span>
                <span class="bi bi-chat-dots-fill me-3"> 
                  <span class="">{{ article.comment_set.all.count }}</span>
                </span>
                <span class="bi bi-eye-fill"> 
                  <span class=""></span>
                </span>
              </div>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>

  <div class="position-fixed fixed-bottom text-end">
    {% if request.user.is_authenticated %}
      <a class="btn btn-primary m-5" href="{% url 'articles:create' %}">글쓰기</a>
    {% endif %}
  </div>
{% endblock content %}